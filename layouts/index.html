{{ define "main" }}

<!-- banner -->
{{ with .Params.banner }}
<section class="banner banner-with-video">
  {{ if .video }}
  {{ $videoResource := resources.Get .video }}
  {{ if $videoResource }}
  <video class="banner-video" autoplay muted loop playsinline id="hero-video">
    <source src="{{ $videoResource.RelPermalink }}" type="video/mp4">
  </video>
  {{ else }}
  {{ $staticVideo := printf "/%s" .video }}
  <video class="banner-video" autoplay muted loop playsinline id="hero-video">
    <source src="{{ $staticVideo }}" type="video/mp4">
  </video>
  {{ end }}
  <script>
    (function() {
      const video = document.getElementById('hero-video');
      if (video) {
        // Set playback rate to 0.75x (75% speed)
        video.playbackRate = 0.5;
        
        // Also set it when video is loaded in case the above doesn't work immediately
        video.addEventListener('loadedmetadata', function() {
          video.playbackRate = 0.5;
        });
      }
    })();
  </script>
  {{ end }}
  <div class="banner-overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-10 mx-auto text-center">
        <h1 class="mb-3">{{ .title | markdownify }}</h1>
        <p class="mb-4">{{ .content | markdownify }}</p>
        <div class="banner-buttons">
          {{ if .button.enable }}
          {{ with .button }}
          <a href="{{ .link | safeURL }}" title="{{ .label }}" class="btn btn-primary">{{ .label }}</a>
          {{ end }}
          {{ end }}
          {{ if .button2.enable }}
          {{ with .button2 }}
          <a href="{{ .link | safeURL }}" title="{{ .label }}" class="btn btn-teal">{{ .label }}</a>
          {{ end }}
          {{ end }}
        </div>

        {{with .image}}<img src="{{ . | relURL }}" alt="" class="img-fluid mt-5" width="750px">{{end}}
      </div>
    </div>
  </div>
</section>
{{ end }}
<!-- /banner -->

<!-- feature -->
{{ with .Params.feature }}
{{ if .enable }}
<section class="section bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
      </div>
      {{ range .feature_item }}
      <div class="col-md-4 col-sm-6 mb-4">
        {{ if .link }}
        <a href="{{ .link | relURL }}" class="feature-card-link">
        {{ end }}
        <div class="feature-card text-center">
          <i class="{{.icon}} mb-3"></i>
          <h4 class="mb-2">{{ .name | title }}</h4>
          <p>{{ .content | markdownify }}</p>
        </div>
        {{ if .link }}
        </a>
        {{ end }}
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /feature -->

<!-- Statistics Section -->
{{ with .Params.stats }}
{{ if .enable }}
<section class="section stats-section">
  <div class="container">
    <div class="row justify-content-center text-center">
      {{ range .stats_item }}
      <div class="col-lg-3 col-md-6 col-sm-6 mb-4 mb-lg-0">
        <div class="stat-card-modern p-4 rounded-3 shadow-sm h-100">
          <div class="stat-icon mb-3">
            <i class="{{ .icon }}"></i>
          </div>
          <div class="stat-number mb-2">{{ .number }}</div>
          <div class="stat-label">{{ .label }}</div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Statistics -->

<!-- latest events -->
{{ with .Params.latest_events }}
{{ if .enable }}
<section class="section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
      </div>
    </div>
    <div class="row">
      {{ $events := where site.RegularPages "Section" "events" }}
      {{ $sortedEvents := sort $events "Date" "desc" }}
      {{ range first (.count | default 2) $sortedEvents }}
      <div class="col-md-6 mb-4">
        <div class="card event-card h-100 border-0 shadow-sm">
          {{ if .Params.image }}
          {{ partial "image.html" (dict "Src" .Params.image "Alt" .Title "Class" "card-img-top rounded-top" "Size" "600x300") }}
          {{ end }}
          <div class="card-body p-4">
            {{ if .Params.date }}
            <small class="text-muted d-block mb-2">
              <i class="far fa-calendar me-1"></i>{{ .Date.Format "January 2, 2006" }}
            </small>
            {{ end }}
            <h3 class="h4 mb-3">
              <a href="{{ .Permalink }}" class="text-dark text-decoration-none">{{ .Title }}</a>
            </h3>
            <p class="mb-3">{{ .Summary | truncate 150 }}</p>
            <div class="text-end">
              <a href="{{ .Permalink }}" class="text-link">Read More</a>
            </div>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
    {{ if .view_all_link }}
    <div class="row mt-5">
      <div class="col-12 text-end">
        <a href="{{ .view_all_link | relURL }}" class="btn btn-teal">More Events <i class="fas fa-arrow-right ms-2"></i></a>
      </div>
    </div>
    {{ end }}
  </div>
</section>
{{ end }}
{{ end }}
<!-- /latest events -->

<!-- service -->
{{ with .Params.service }}
{{ if .enable }}
{{ range $i,$p := .service_item }}
{{if modBool $i 2}}
<section class="section bg-light">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6 order-2 order-md-1">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        <p>{{ .content | markdownify }}</p>
        {{ if .quote.enable }}
        <div class="service-quote mt-4">
          <p class="mb-0 fst-italic fw-medium text-muted">{{ .quote.text | markdownify }}</p>
        </div>
        {{ end }}
        {{ if .button.enable }}
        {{ with .button }}
        <a href="{{ .link | relURL }}" title="{{ .label }}" class="btn-link">{{ .label }} <i
            class="fas fa-arrow-right"></i></a>
        {{ end }}
        {{ end }}
      </div>
      <div class="col-md-6 order-1 order-md-2 mb-4 mb-md-0">
        <div class="swiper testimonial-slider">
            <div {{if gt (len .images) 1}}class="swiper-wrapper" {{end}}>
              {{ range .images }}
              <div class="swiper-slide">
                {{ partial "image.html" (dict "Src" . "Alt" "Image" ) }}
              </div>
              {{ end }}
            </div>
          <div class="testimonial-slider-pagination mt-9 flex items-center justify-center text-center"></div>
        </div>
      </div>
    </div>
  </div>
</section>
{{ else }}
<section class="section">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6 mb-4 mb-md-0">
        <div class="swiper testimonial-slider">
          <div {{if gt (len .images) 1}}class="swiper-wrapper" {{end}}>
            {{ range .images }}
            <div class="swiper-slide">
              {{ partial "image.html" (dict "Src" . "Alt" "Image" ) }}
            </div>
            {{ end }}
          </div>
        <div class="testimonial-slider-pagination mt-9 flex items-center justify-center text-center"></div>
      </div>
      </div>
      <div class="col-md-6">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        <p>{{ .content | markdownify }}</p>
        {{ if .quote.enable }}
        <div class="service-quote mt-4">
          <p class="mb-0 fst-italic fw-medium text-muted">{{ .quote.text | markdownify }}</p>
        </div>
        {{ end }}
        {{ if .button.enable }}
        {{ with .button }}
        <a href="{{ .link | relURL }}" title="{{ .label }}" class="btn-link">{{ .label }} <i
            class="fas fa-arrow-right"></i></a>
        {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
</section>
{{ end }}
{{ end }}
{{ end }}
{{ end }}
<!-- /service -->

<!-- Auto-rotate service sliders -->
<script>
(function() {
  function initSlidersWithAutoplay() {
    if (typeof Swiper === 'undefined') {
      setTimeout(initSlidersWithAutoplay, 100);
      return;
    }
    
    // Wait for page to fully load
    setTimeout(function() {
      const sliderContainers = document.querySelectorAll('.testimonial-slider');
      
      sliderContainers.forEach(function(container) {
        // Check if swiper-wrapper exists (multiple images)
        const wrapper = container.querySelector('.swiper-wrapper');
        if (!wrapper) return; // Skip if no wrapper (single image)
        
        // Destroy existing swiper instance if any
        if (container.swiper) {
          container.swiper.destroy(true, true);
        }
        
        // Find pagination element - it's inside the swiper container
        const paginationEl = container.querySelector('.testimonial-slider-pagination');
        
        if (!paginationEl) return; // Skip if no pagination found
        
        // Initialize with autoplay
        new Swiper(container, {
          spaceBetween: 24,
          loop: true,
          autoplay: {
            delay: 10000, // 10 seconds
            disableOnInteraction: false, // Continue after user clicks pagination
          },
          pagination: {
            el: paginationEl,
            type: "bullets",
            clickable: true,
          },
        });
      });
    }, 500);
  }
  
  // Start initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSlidersWithAutoplay);
  } else {
    initSlidersWithAutoplay();
  }
})();
</script>

<!-- Research Outputs Section -->
{{ with .Params.research_outputs }}
{{ if .enable }}
<section class="section bg-light">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{ if .subtitle }}
        <p class="text-muted mb-0">{{ .subtitle | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    <div class="row">
      {{ range .items }}
      <div class="col-lg-6 mb-4">
        <div class="detailed-service-card-modern h-100">
          <div class="detailed-card-header">
            <div class="detailed-service-icon-modern">
              <i class="{{ .icon }}"></i>
            </div>
            <h3 class="h4 mb-0">{{ .name | markdownify }}</h3>
          </div>
          <div class="detailed-card-body">
            <p class="mb-4">{{ .description | markdownify }}</p>
            {{ if .features }}
            <div class="feature-grid mb-4">
              {{ range .features }}
              <div class="feature-item">
                <i class="fas fa-check text-primary me-2"></i>
                <span>{{ . | markdownify }}</span>
              </div>
              {{ end }}
            </div>
            {{ end }}
            <a href="{{ .link | relURL }}" class="detailed-card-link">
              {{ .button_label | default "Learn More" }} <i class="fas fa-arrow-right ms-2"></i>
            </a>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Research Outputs -->

<!-- Community Engagement Section -->
{{ with .Params.community_engagement }}
{{ if .enable }}
<section class="section">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{ if .subtitle }}
        <p class="text-muted mb-0">{{ .subtitle | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    <div class="row">
      {{ range .items }}
      <div class="col-lg-6 mb-4">
        <div class="detailed-service-card-modern h-100">
          <div class="detailed-card-header">
            <div class="detailed-service-icon-modern">
              <i class="{{ .icon }}"></i>
            </div>
            <h3 class="h4 mb-0">{{ .name | markdownify }}</h3>
          </div>
          <div class="detailed-card-body">
            <p class="mb-4">{{ .description | markdownify }}</p>
            {{ if .features }}
            <div class="feature-grid mb-4">
              {{ range .features }}
              <div class="feature-item">
                <i class="fas fa-check text-teal me-2"></i>
                <span>{{ . | markdownify }}</span>
              </div>
              {{ end }}
            </div>
            {{ end }}
            <a href="{{ .link | relURL }}" class="detailed-card-link detailed-card-link-teal">
              {{ .button_label | default "Learn More" }} <i class="fas fa-arrow-right ms-2"></i>
            </a>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Community Engagement -->

<!-- Resources & Support Section -->
{{ with .Params.resources_support }}
{{ if .enable }}
<section class="section bg-light">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{ if .subtitle }}
        <p class="text-muted mb-0">{{ .subtitle | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    <div class="row">
      {{ range .items }}
      <div class="col-lg-6 mb-4">
        <div class="detailed-service-card-modern h-100">
          <div class="detailed-card-header">
            <div class="detailed-service-icon-modern">
              <i class="{{ .icon }}"></i>
            </div>
            <h3 class="h4 mb-0">{{ .name | markdownify }}</h3>
          </div>
          <div class="detailed-card-body">
            <p class="mb-4">{{ .description | markdownify }}</p>
            {{ if .features }}
            <div class="feature-grid mb-4">
              {{ range .features }}
              <div class="feature-item">
                <i class="fas fa-check text-primary me-2"></i>
                <span>{{ . | markdownify }}</span>
              </div>
              {{ end }}
            </div>
            {{ end }}
            <a href="{{ .link | relURL }}" class="detailed-card-link">
              {{ .button_label | default "Learn More" }} <i class="fas fa-arrow-right ms-2"></i>
            </a>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Resources & Support -->

<!-- Testimonials Section -->
{{ with .Params.testimonials }}
{{ if .enable }}
<section class="section">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{ if .subtitle }}
        <p class="text-muted mb-4">{{ .subtitle | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    <div class="row">
      {{ range .testimonials_item }}
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="testimonial-card-modern h-100 p-4 rounded-3 shadow-sm">
          <div class="testimonial-content mb-4">
            <div class="quote-icon mb-3">
              <i class="fas fa-quote-left text-primary"></i>
            </div>
            <p class="mb-0">{{ .content | markdownify }}</p>
          </div>
          <div class="testimonial-author">
            <h5 class="mb-1 fw-bold">{{ .name | markdownify }}</h5>
            <p class="mb-0 text-muted small">{{ .designation | markdownify }}</p>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
    {{ if .view_all_link }}
    <div class="row mt-5">
      <div class="col-12 text-center">
        <a href="{{ .view_all_link | relURL }}" class="btn btn-primary">View All Testimonials <i class="fas fa-arrow-right ms-2"></i></a>
      </div>
    </div>
    {{ end }}
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Testimonials -->

<!-- Research Center Units Section -->
{{ with .Params.research_units }}
{{ if .enable }}
<section class="section bg-light research-units-section">
  <div class="container">
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{ if .subtitle }}
        <p class="text-muted mb-0">{{ .subtitle | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    <div class="row">
      {{ range .featured_units }}
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="research-unit-card h-100 rounded-3 overflow-hidden shadow-sm">
          <div class="unit-image-container">
            {{ if .image }}
            {{ partial "image.html" (dict "Src" .image "Alt" .name "Class" "unit-image" "Size" "400x300") }}
            {{ else }}
            <div class="unit-image-placeholder">
              <i class="fas fa-image text-muted" style="font-size: 3rem;"></i>
              <p class="text-muted mt-2">Image placeholder</p>
            </div>
            {{ end }}
          </div>
          <div class="unit-content p-4">
            <h3 class="h5 mb-3 fw-bold">{{ .name | markdownify }}</h3>
            <a href="{{ .link | relURL }}" class="unit-link">Visit the Unit</a>
          </div>
        </div>
      </div>
      {{ end }}
    </div>
    
    {{ if .more_units.enable }}
    <div class="row mt-5">
      <div class="col-lg-8 mx-auto text-center">
        <h2 class="section-title mb-4">{{ .more_units.title | markdownify }}</h2>
        {{ if .more_units.subtitle }}
        <p class="text-muted mb-4">{{ .more_units.subtitle | markdownify }}</p>
        {{ end }}
        {{ if .more_units.button_link }}
        <a href="{{ .more_units.button_link | relURL }}" class="btn btn-primary">{{ .more_units.button_label | default "All Units" }}</a>
        {{ end }}
      </div>
    </div>
    {{ end }}
  </div>
</section>
{{ end }}
{{ end }}
<!-- /Research Center Units -->


<!-- screenshot -->
{{ with .Params.screenshot }}
{{ if .enable }}
<section class="section pb-0">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto text-center">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
      </div>
    </div>
  </div>
  {{ with .image }} <img src="{{ . | relURL }}" alt="" class="img-fluid w-100">{{ end }}
</section>
{{ end }}
{{ end }}
<!-- /screenshot -->

<!-- call to action -->
{{ with .Params.call_to_action }}
{{ if .enable }}
<section class="section">
  <div class="container section shadow rounded-lg px-4">
    <div class="row align-items-center justify-content-center text-center text-md-left">
      <div class="col-lg-4 col-md-5 mb-4 mb-md-0">
        {{ partial "image" (dict "Src" .image "Alt" "call to action image" "Class" "img-fluid w-100") }}
      </div>
      <div class="col-lg-5 col-md-6">
        <h2 class="section-title">{{ .title | markdownify }}</h2>
        {{with .content }}<p class="mb-4">{{ . | markdownify }}</p>{{ end }}
        {{ if .button.enable }}
        {{ with .button }}
        <a href="{{ .link | relURL }}" title="{{ .label }}" class="btn btn-primary">{{ .label }}</a>
        {{ end }}
        {{ end }}
      </div>
    </div>
  </div>
</section>
{{ end }}
{{ end }}
<!-- /call to action -->

{{ end }}
