{{ define "main" }}
{{ partial "page-header.html" . }}

<!-- Lab Details -->
<section class="section lab-details-section">
  <div class="container">
    <div class="row mb-5">
      <div class="col-lg-8">
        <div class="lab-hero mb-4">
          {{ if .Params.image }}
          <div class="lab-main-image mb-4 rounded-3 overflow-hidden">
            {{ partial "image.html" (dict "Src" .Params.image "Alt" .Title "Class" "w-100" "Size" "800x500") }}
          </div>
          {{ end }}
          <div class="lab-content">
            {{ .Content }}
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="lab-sidebar">
          <div class="lab-info-card p-4 rounded-3 shadow-sm mb-4">
            <h3 class="h5 mb-4">Lab Information</h3>
            {{ if .Params.location_name }}
            <div class="info-item mb-3">
              <strong><i class="fas fa-map-marker-alt text-primary me-2"></i>Location:</strong>
              <p class="mb-0 mt-1">{{ .Params.location_name }}</p>
            </div>
            {{ end }}
            {{ if .Params.category_name }}
            <div class="info-item mb-3">
              <strong><i class="fas fa-tag text-primary me-2"></i>Category:</strong>
              <p class="mb-0 mt-1">{{ .Params.category_name }}</p>
            </div>
            {{ end }}
            {{ if .Params.capacity }}
            <div class="info-item mb-3">
              <strong><i class="fas fa-users text-primary me-2"></i>Capacity:</strong>
              <p class="mb-0 mt-1">{{ .Params.capacity }}</p>
            </div>
            {{ end }}
            {{ if .Params.status }}
            <div class="info-item mb-3">
              <strong><i class="fas fa-circle text-primary me-2"></i>Status:</strong>
              <p class="mb-0 mt-1">
                <span class="badge {{ if eq .Params.status "active" }}bg-success{{ else }}bg-secondary{{ end }}">
                  {{ .Params.status | title }}
                </span>
              </p>
            </div>
            {{ end }}
            {{ if .Params.contact }}
            <div class="info-item">
              <strong><i class="fas fa-envelope text-primary me-2"></i>Contact:</strong>
              <p class="mb-0 mt-1">
                <a href="mailto:{{ .Params.contact }}" class="text-decoration-none">{{ .Params.contact }}</a>
              </p>
            </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
    
    <!-- Equipment Section -->
    {{ if .Params.equipment }}
    <div class="row">
      <div class="col-12">
        <div class="equipment-section">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title mb-0">Equipment & Devices</h2>
            <div class="equipment-filters">
              <input type="text" id="equipmentNameSearch" class="form-control form-control-sm d-inline-block" style="width: 200px;" placeholder="Search by name...">
              <select id="equipmentCategoryFilter" class="form-select form-select-sm d-inline-block ms-2" style="width: 150px;">
                <option value="">All Categories</option>
              </select>
            </div>
          </div>
          <div class="row" id="equipmentGrid">
            {{ range .Params.equipment }}
            <div class="col-lg-4 col-md-6 mb-4 equipment-item" 
                 data-name="{{ .name | lower }}"
                 data-category="{{ .category | default "" | urlize }}">
              <div class="equipment-card h-100 p-4 rounded-3 shadow-sm">
                {{ if .image }}
                <div class="equipment-image mb-3">
                  {{ partial "image.html" (dict "Src" .image "Alt" .name "Class" "w-100 rounded" "Size" "300x200") }}
                </div>
                {{ end }}
                <div class="equipment-category mb-2">
                  {{ if .category }}
                  <span class="badge bg-light text-dark">{{ .category | title }}</span>
                  {{ end }}
                  {{ if .status }}
                  <span class="badge {{ if eq .status "available" }}bg-success{{ else if eq .status "in-use" }}bg-warning{{ else }}bg-secondary{{ end }} ms-2">
                    {{ .status | title }}
                  </span>
                  {{ end }}
                </div>
                <h3 class="h5 mb-2 fw-bold">{{ .name }}</h3>
                {{ if .model }}
                <p class="text-muted small mb-2"><strong>Model:</strong> {{ .model }}</p>
                {{ end }}
                {{ if .description }}
                <p class="text-muted small mb-3">{{ .description }}</p>
                {{ end }}
                {{ if .specifications }}
                <div class="equipment-specs">
                  <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#specs-{{ .id }}" aria-expanded="false">
                    View Specifications
                  </button>
                  <div class="collapse mt-2" id="specs-{{ .id }}">
                    <ul class="list-unstyled small">
                      {{ range .specifications }}
                      <li class="mb-1"><i class="fas fa-check text-primary me-2"></i>{{ . }}</li>
                      {{ end }}
                    </ul>
                  </div>
                </div>
                {{ end }}
              </div>
            </div>
            {{ end }}
          </div>
          <div id="noEquipmentResults" style="display: none;">
            <div class="text-center py-5">
              <p class="text-muted">No equipment found matching your search criteria.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    {{ end }}
  </div>
</section>
<!-- /Lab Details -->

<script>
(function() {
  const equipmentItems = document.querySelectorAll('.equipment-item');
  const equipmentNameSearch = document.getElementById('equipmentNameSearch');
  const equipmentCategoryFilter = document.getElementById('equipmentCategoryFilter');
  const equipmentGrid = document.getElementById('equipmentGrid');
  const noEquipmentResults = document.getElementById('noEquipmentResults');
  
  if (!equipmentItems.length) return;
  
  // Collect unique categories
  const categories = new Set();
  equipmentItems.forEach(item => {
    const category = item.getAttribute('data-category');
    if (category) categories.add(category);
  });
  
  // Populate category filter
  Array.from(categories).sort().forEach(category => {
    const option = document.createElement('option');
    option.value = category;
    option.textContent = category.split('-').map(word => 
      word.charAt(0).toUpperCase() + word.slice(1)
    ).join(' ');
    equipmentCategoryFilter.appendChild(option);
  });
  
  // Filter function
  function filterEquipment() {
    const searchTerm = equipmentNameSearch.value.toLowerCase();
    const selectedCategory = equipmentCategoryFilter.value.toLowerCase();
    
    let visibleCount = 0;
    
    equipmentItems.forEach(item => {
      const itemName = item.getAttribute('data-name');
      const itemCategory = item.getAttribute('data-category').toLowerCase();
      
      const nameMatch = !searchTerm || itemName.includes(searchTerm);
      const categoryMatch = !selectedCategory || itemCategory === selectedCategory;
      
      if (nameMatch && categoryMatch) {
        item.style.display = '';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });
    
    // Show/hide no results message
    if (visibleCount === 0) {
      equipmentGrid.style.display = 'none';
      noEquipmentResults.style.display = 'block';
    } else {
      equipmentGrid.style.display = '';
      noEquipmentResults.style.display = 'none';
    }
  }
  
  // Event listeners
  equipmentNameSearch.addEventListener('input', filterEquipment);
  equipmentCategoryFilter.addEventListener('change', filterEquipment);
})();
</script>

{{ end }}
